<!DOCTYPE html>
<html lang="en" manifest="/cache.mf">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">
    <link rel="icon" href="/favicon.ico">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link href="/_sass/main.css" rel="stylesheet" type="text/css">
    <style type="riot"></style>
    <script src="/_js/libJs/loadjs.min.js" type="text/javascript"></script>
    <script src="//cdn.jsdelivr.net/js-signals/1.0.0/signals.min.js" type="text/javascript"></script>
    <script src="/_js/setup.js" type="text/javascript"></script>
    <script src="/_js/main.js" async="" type="text/javascript"></script>
    <meta name="description" content="">
    <script>_loadStarted = (new Date()).getTime()</script>
  </head>
  <body>
    <script type="riot/tag" src="/_uiComps/home-card.html"></script>
    <script type="riot/tag" src="/_uiComps/x-vid.html"></script>
    <div id="ss1">
      <nav class="mui-container-fluid mui--no-user-select" id="appbar">
        <table width="100%">
          <tr>
            <td>
              <div id="brand">☰ &nbsp;<span class="mui--hidden-xs">Massons-Foundation.org</span><a href="https://www.masons-foundation.org/home/feed/" id="navPrev"> &nbsp; ☚ &nbsp;</a></div>
            </td>
            <td class="mui--text-right">
              <ul class="mui-list--inline" id="menu">
                <li class="mui--hidden-xs"><a class="mui--hidden-xs" href="/train/bestWComps/">Home</a></li>
                <li class="mui--hidden-xs"><a class="mui--hidden-xs" href="/train/schedule/">Schedule</a></li>
                <li><a href="/home/feed/">Feed</a></li>
                <li><a href="/home/fts/">Search</a></li>
                <li>&nbsp;</li>
              </ul>
            </td>
          </tr>
        </table>
      </nav>
      <div id="sidedrawer">
        <nav class="mui--no-user-select" id="sidenav">
          <h2>
            <div class="mui--text-title" id="sidedrawer-brand">☰ &nbsp; Massons</div>
          </h2>
          <div class="mui-divider"></div>
          <ul class="mui-list--unstyled" id="sidenavstrong">
            <li><a href="/train/bestWComps/">Home</a></li>
            <li><a href="/train/schedule/">Schedule</a></li>
            <li><a href="/home/feed/">Feed</a></li>
            <li><a href="/home/fts/">Search</a></li>
          </ul>
        </nav>
      </div>
      <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Roboto:regular,bold,italic&amp;lang=en">
      <div id="content-wrapper0"> 
        <div id="content-wrapper">
          <div class="mui-container-fluid"><h1 id="data-binding">Data Binding</h1>
<p>One of the things that nodes has over JSP/ASP/PHP and such is that you can reuse more front end/browser and server side code. And data binding is one of key skills to have. </p>
<h3 id="prerequesites">Prerequesites</h3>
<p>Surprisingly, this exercise can be a broad topic. In this case, I need you to know how to do pre-processing before starting, learned elsewhere. For example Sass and Pug (found in CodePen and lots of google github examples). Learning pre-processing allows us to manage the potential of sprawl. 
Also, we are using fetch() browser api, as even jquery 3.1 started deprecating &#39;ajax&#39; by makeing it optional in jquery slim. </p>
<h3 id="browser-side-data-binding">Browser side data binding</h3>
<p>In a browser we can fetch() from a micro service and bind. This is the bind code itself:</p>
<pre><code>&lt;ul&gt;{{for people}}
    &lt;li&gt;Name: {{:name}}&lt;/li&gt;  
{{/for}}
&lt;/ul&gt;
</code></pre><p>And your page also needs a .js library imported, I&#39;m using a library that works in browser and in node, server side, jsRender:</p>
<pre><code>&lt;script src=&quot;jsrender.min.js&quot;&gt;
</code></pre><p>And now we can implement the library by calling a microservice, with that template:</p>
<pre><code>fetch(&#39;https://rch-demo.appspot.com/membersPg/mem/&#39;, { 
    method: &#39;get&#39;
    }).then(function(response) {
        return (response.json())
    }).then(function(value) {
        // your code here
        let tmpl = $.templates(&quot;#peopleList&quot;) // the id of template
        let html2 = tmpl.render( value )
        $(&#39;#peopleList&#39;).html(html2)
    }).catch(function(err) {
        console.log(err)
})//fetch()
</code></pre><p>And we have to serve this page, with node/express it is one line:</p>
<pre><code>server.use(express.static(&#39;www&#39;)) //folder w/ content
</code></pre><p>Notice how we have UI and then the browser executes the fetch for data.</p>
<p>The file layout looks something like this:
<img src="/post/dBind/layout.png" alt="">
Notice on the far left of the image we have index.js, that we run via:</p>
<pre><code>node index
</code></pre><p>And to the far right of the image is a folder that has spa.html. The folder contains the bundle needed for that url, in this case <a href="http://localhost:8080/post/one/spa.html">http://localhost:8080/post/one/spa.html</a>.<br>For me each folder maps to url and has spa.html that is served for browser rendered page. I also re-use code, for example header, footer, and combine partials using Pug. Also it has amp.html - that is rendered on the server, next:</p>
<h3 id="data-binding-in-node-">Data binding in Node:</h3>
<p>So we are going to re-use, of course. Here is the files:
    <a href="http://github.com/topseed/topseed-demos/tree/master/webApp/www/members/dBindEx">http://github.com/topseed/topseed-demos/tree/master/webApp/www/members/dBindEx</a></p>
<p>Make sure you view _common.pug file above, it is used in spa.html and amp.html :-). We have to read the amp.file in node:</p>
<pre><code>server.get(&#39;/members/dBindEx/&#39;, function (req, res) {
    fs.readFile(&#39;./www//members/dBindEx/amp.html&#39;, &#39;utf8&#39;, function(err, data) {
        let tmpl = jsrender.templates(data)
        fetch(&#39;https://rch-demo.appspot.com/membersPg/mem/&#39;, { 
            method: &#39;get&#39;
            }).then(function(response) {
                return (response.json())
            }).then(function(value) { 
                // your code here
                let html2 = tmpl.render( value )
                res.send(html2)
            }).catch(function(err) {
                console.log(err)
        })//fetch()
    })// readfile
</code></pre><p>In this case, the server waits for the microservice, and sends the UI and bound data together. There is no js scripts in the browser.</p>
<p>To do server both  node side and browser side data binding you need something like:</p>
<pre><code>server.get(&#39;/members/dBindEx/&#39;, function (req, res) {
    const isWWWW = ...
    if(isWWWW) {
        ...
        }
    else { ...
</code></pre><p>ex: <a href="http://github.com/topseed/topseed-demos/blob/master/webApp/index.js">http://github.com/topseed/topseed-demos/blob/master/webApp/index.js</a></p>
<h2 id="summary-and-misc-">Summary and misc.</h2>
<p>Most sites required dynamic data. We can do data binding from browser; and then reuse the template and use similar code to do that server side, before the page is sent to the browser - and we can do both at the same time. Sometimes we need a rich interactive page and sometimes we can&#39;t use .js in a browser.
I suggest you avoid data binding libraries that only do one or the other. </p>
<p>There are component libraries that do data binding, they require you to write a component if you want to do data binding. I suggest you use components for re-use and encapsulation of UI. If it does not work in a plain page, it won&#39;t work well when you make it re-usable. (there is an article here on proper use of standard web components)</p>

          </div>
          <script>
            function init() {
            }
            
            A.onLoaded(init)
            
            
          </script>
        </div>
      </div>
    </div>
    <p><br></p>
    <footer id="footer">
      <p></p>
      <div class="mui-panel">
        <div class="mui-container-fluid">
          <div class="mui-row">
            <div class="mui-col-sm-1 mui--hidden-xs"></div>
            <div class="mui-col-sm-3 mui--hidden-xs"><a class="mui--hidden-xs" href="https://gitter.im/topseed-demos/Lobby">Forum </a></div>
            <div class="mui-col-sm-3"><a href="https://amp.masons-foundation.org/home/contactUs/">ContactUs</a></div>
            <div class="mui-col-sm-3 mui--pull-right mui--hidden-xs">Experimental</div>
            <div class="mui-col-sm-1 mui--hidden-xs"></div>
          </div>
        </div>
      </div>
    </footer>
    <script type="text/javascript">
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
      
      ga('create', 'UA-82096733-1', 'auto');
      ga('send', 'pageview');
    </script>
  </body>
</html>